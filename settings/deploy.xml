<?xml version="1.0" encoding="UTF-8"?>

<project name="phing-drupal" default="deploy">

	<target name="properties">
	  <property name="make.dir" value="htdocs" />
	  <property name="remote.host" value="localhost" />
	  <property name="remote.path" value="/tmp" />
	  <property name="environment" value="test" />
	</target>

	<target name="deploy" depends="buildname, properties">
	  <echo msg="Deploying ${build.name} to server" />
	  <ssh  username="jenkins" privkeyfile="/home/jenkins/.ssh/id_rsa" pubkeyfile="/home/jenkins/.ssh/id_rsa.pub" host="${remote.host}" command="mkdir ${remote.path}/builds/${build.name}"/>
	  <exec command="scp -rq ../${make.dir} ${remote.host}:${remote.path}/builds/${build.name}" logoutput="yes" />
	  <exec command="scp -rq ../settings ${remote.host}:${remote.path}/builds/${build.name}" logoutput="yes" />
	
	 <echo msg="${remote.path}/builds/${build.name}/htdocs/sites/default"/>
	
	 <ssh username="jenkins" privkeyfile="/home/jenkins/.ssh/id_rsa" pubkeyfile="/home/jenkins/.ssh/id_rsa.pub"  host="${remote.host}" command="
             cd ${remote.path}/builds/${build.name}/htdocs/sites/default &amp;&amp;
             ln -s ../../../settings/${environment}.settings.php settings.php"/>

	  <!--<ssh username="jenkins" privkeyfile="/home/jenkins/.ssh/id_rsa" pubkeyfile="/home/jenkins/.ssh/id_rsa.pub"  host="${remote.host}" command="
             cd ${remote.path}/builds/${build.name}/htdocs/sites/default &amp;&amp;
             ln -s ../../../settings/${environment}.settings.php settings.php &amp;&amp;
             ln -s ../../../../../assets/files files &amp;&amp;
             cd ${remote.path} &amp;&amp;
             ln -sfn builds/${build.name} site"/>
	  -->
	  
  	</target>

        <taskdef classname="VersionNumberTask" name="versiontask" classpath="phingdrushtask" />

        <target name="buildname">
          <versiontask versionprop="build.name"/>
        </target>

</project>
